{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h1>Weekly Exercise Tracker</h1>
    
    <div class="row">
        {% for day, data in week_data.items %}
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5>{{ day|date:"l" }} - {{ day|date:"M d, Y" }}</h5>
                        <p>Total Time: <span id="total-duration">{{ data.total_time }}</span> minutes</p>
                        <p>Total Calories: <span id="total-calories">{{ data.total_calories }}</span> kcal</p>
                        <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#addExerciseModal" onclick="setDate('{{ day|date:'d-m-Y' }}')">Add Exercise</button>
                        <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#viewExercisesModal" onclick="viewData()">View Exercises</button>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<!-- Add Exercise Modal -->
<div class="modal fade" id="addExerciseModal" tabindex="-1" aria-labelledby="addExerciseModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addExerciseModalLabel">Add Exercise for <span id="modal-date"></span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Ensure onsubmit is on the form and there's no action or method attributes -->
                <form id="addExerciseForm" onsubmit="saveData(event)">
                    <input type="hidden" id="exercise-date" name="date">
                    <div class="form-group">
                        <label for="exercise-name">Exercise Name</label>
                        <input type="text" class="form-control" id="exercise-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="exercise-duration">Duration (minutes)</label>
                        <input type="number" class="form-control" id="exercise-duration" name="duration" required>
                    </div>
                    <div class="form-group">
                        <label for="exercise-calories">Calories Burned</label>
                        <input type="number" class="form-control" id="exercise-calories" name="calories_burned" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Exercise</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- View Exercises Modal -->
<div class="modal fade" id="viewExercisesModal" tabindex="-1" aria-labelledby="viewExercisesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewExercisesModalLabel">Exercises for <span id="view-modal-date"></span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="exercise-list-content">
                
            </div>
        </div>
    </div>
</div>



<script>
    // Function to set date in the Add Exercise modal
    function setDate(date) {
        document.getElementById("exercise-date").value = date;
        document.getElementById("modal-date").textContent = date;
    }

    // Save data to session storage and prevent form submission
    function saveData(event) {
        event.preventDefault();  // Prevent the default form submission behavior
    
        // Retrieve the exercise details from form inputs
        const date = document.getElementById("exercise-date").value;
        const name = document.getElementById("exercise-name").value;
        const duration = parseInt(document.getElementById("exercise-duration").value);
        const calories_burned = parseInt(document.getElementById("exercise-calories").value);
    
        // Create an exercise object
        const exercise = { date, name, duration, calories_burned };
    
        // Retrieve existing exercises from sessionStorage or initialize an empty array
        let exercises = JSON.parse(sessionStorage.getItem("exercises")) || [];
    
        // Add the new exercise to the array
        exercises.push(exercise);
    
        // Save the updated exercises array back to sessionStorage
        sessionStorage.setItem("exercises", JSON.stringify(exercises));
    
        // Update the total duration and calories burned for the day
        updateTotals();
    
        // Close the Add Exercise modal and reset the form
        $('#addExerciseModal').modal('hide');
        document.getElementById("addExerciseForm").reset();
    }
    
    function updateTotals() {
        // Retrieve all exercises from sessionStorage
        const exercises = JSON.parse(sessionStorage.getItem("exercises")) || [];
    
        // Initialize total counters
        let totalDuration = 0;
        let totalCalories = 0;
    
        // Calculate the totals for the current day
        exercises.forEach(exercise => {
            totalDuration += exercise.duration;
            totalCalories += exercise.calories_burned;
        });
    
        // Update the HTML with the new totals
        document.getElementById("total-duration").textContent = totalDuration;
        document.getElementById("total-calories").textContent = totalCalories;
    }
    
    function viewData() {
        // Retrieve exercises from sessionStorage
        const exercises = JSON.parse(sessionStorage.getItem("exercises")) || [];
    
        // Get the container element for the exercise list in the modal
        const exerciseListContent = document.getElementById("exercise-list-content");
    
        // Clear the previous exercise list
        exerciseListContent.innerHTML = "";
    
        // Populate the modal with each exercise
        exercises.forEach((exercise, index) => {
            const exerciseItem = document.createElement("div");
            exerciseItem.classList.add("exercise-item");
            exerciseItem.innerHTML = `
                <p><strong>Exercise ${index + 1}</strong></p>
                <p><strong>Date:</strong> ${exercise.date}</p>
                <p><strong>Name:</strong> ${exercise.name}</p>
                <p><strong>Duration:</strong> ${exercise.duration} minutes</p>
                <p><strong>Calories Burned:</strong> ${exercise.calories_burned} kcal</p>
                <hr>
            `;
            exerciseListContent.appendChild(exerciseItem);
        });
    }
    
    


</script>

{% endblock content %}

